/*
 * Created by cuishang.
 * 2019.4.22
 */
#include <linux/kernel.h>
#include <linux/slab.h>
#include <linux/module.h>
#include <linux/init.h>
#include <linux/usb/input.h>
#include <linux/hid.h>


static int usb_mouse_probe(struct usb_interface *intf, const struct usb_device_id *id)
{
    struct usb_device *dev = interface_to_usbdev(intf);
    printk("cuishang found usb device !\n");
    return 0;
}

static void usb_mouse_disconnect(struct usb_interface *intf)
{
    printk("cuishang disconnect usb device !\n");
}

/*
*ID_TABLE 解释：
*
*#define USB_INTERFACE_INFO(cl, sc, pr) \
*   .match_flags = USB_DEVICE_ID_MATCH_INT_INFO, \  //用于匹配设备的接口描述符的3个成员
*   .bInterfaceClass = (cl), \
*   .bInterfaceSubClass = (sc), \
*   .bInterfaceProtocol = (pr)
*
* cl = USB_INTERFACE_CLASS_HID;     //HID 类是与人类交互有关的设备。（human interface device）
* sc = USB_INTERFACE_SUBCLASS_BOOT, //设置匹配USB的接口子类型为启动设备
* pr = USB_INTERFACE_PROTOCOL_MOUSE,//设置匹配USB的接口协议为USB鼠标的协议
*/

static struct usb_device_id usb_mouse_id_table [] = {
    { USB_INTERFACE_INFO(USB_INTERFACE_CLASS_HID, USB_INTERFACE_SUBCLASS_BOOT,
        USB_INTERFACE_PROTOCOL_MOUSE) },
    { } /* Terminating entry */
};

static struct usb_driver usb_mouse_driver = {
    .name       = "usbmouse",
    .probe      = usb_mouse_probe,
    .disconnect = usb_mouse_disconnect,
    .id_table   = usb_mouse_id_table,
};

static int usbmouse_test_init()
{
    usb_register(&usb_mouse_driver);
    return 0;
}

static void usbmouse_test_exit()
{
    usb_deregister(&usb_mouse_driver);
}


module_init(usbmouse_test_init);
module_exit(usbmouse_test_exit);

MODULE_LICENSE("GPL");
