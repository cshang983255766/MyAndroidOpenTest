#include <stdio.h> 
#include <sys/ioctl.h> 
#include <fcntl.h> 
#include <linux/i2c.h>


#define DEVICE_I2C_ADDRESS 0x10  //RWRITE : (0x11 << 1) 
#define DEVICE_REG_ADDRESS 0x00 
#define DEVICE_BUFFER_LEN 8 
#define RETRY_COUNT 3 
#define TIMEOUT_COUNT 50 //500ms, because the unit is 10ms 
#define DEVICE_NAME "/dev/myi2c"

int main(int argc, char** argv) 
{ 
    int result = 0; 
    int fd = -1; 
    int val = 0; 
    fd = open(DEVICE_NAME, O_RDWR); 
    if(fd == -1) 
    { 
        printf("cuishang Failed to open device %s.\n", DEVICE_NAME); 
        return -1; 
    } 

    result = ioctl(fd,I2C_SLAVE_FORCE, DEVICE_I2C_ADDRESS); 
    printf("cuishang I2C_SLAVE_FORCE Ioctl result %d.\n", result); 

    result = ioctl(fd,I2C_RETRIES, RETRY_COUNT);     
    printf("cuishang I2C_RETRIES Ioctl result %d.\n", result); 

    result = ioctl(fd,I2C_TIMEOUT, TIMEOUT_COUNT);     
    printf("cuishang I2C_TIMEOUT Ioctl result %d.\n", result); 
    
    unsigned char regaddr[1] = {DEVICE_REG_ADDRESS}; 
    result = write(fd, regaddr, 1); 
    printf("cuishang writeaddress return: %d\n",result); 
    
    unsigned char readBuf[DEVICE_BUFFER_LEN] = {0}; 
    result = read(fd, &readBuf, DEVICE_BUFFER_LEN);
    printf("cuishang readdata return:%d\n", result); 

    printf("cuishang %s\n", *readBuf);
    
    close(fd); 
    return 0; 
}






